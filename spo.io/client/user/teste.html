<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerar Playlist</title>
</head>
<body>

<!-- Botão para gerar a playlist -->
<button id="generatePlaylistButton">Gerar Playlist de Músicas Aleatórias</button>

<script>
// Função para pegar o token de acesso da URL
function getAccessTokenFromUrl() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('access_token');
}

// Função para fazer chamadas à API do Spotify
async function fetchWebApi(endpoint, method = 'GET', body) {
    const token = getAccessTokenFromUrl();
    if (!token) {
        alert('Token de acesso não encontrado!');
        return;
    }

    const res = await fetch(`https://api.spotify.com/v1/${endpoint}`, {
        headers: {
            Authorization: `Bearer ${token}`,
            'Content-Type': 'application/json'
        },
        method,
        body: body ? JSON.stringify(body) : null
    });

    return await res.json();
}

// Função para criar playlist com músicas aleatórias
async function createPlaylist() {
    try {
        // Obtenha o ID do usuário
        const userData = await fetchWebApi('me');
        const userId = userData.id;

        // Crie a playlist
        const playlistData = await fetchWebApi(`users/${userId}/playlists`, 'POST', {
            name: 'Playlist de Músicas Aleatórias',
            description: 'Playlist com músicas engraçadas e estranhas!',
            public: false
        });

        const playlistId = playlistData.id;

        // Músicas aleatórias (exemplo: Barbie Girl e Manoel Gomes)
        const queries = ['Barbie Girl', 'Manoel Gomes'];
        const trackURIs = [];

        for (const query of queries) {
            const data = await fetchWebApi(`search?q=${encodeURIComponent(query)}&type=track&limit=3`);
            trackURIs.push(...data.tracks.items.map(track => track.uri));
        }

        // Adicione as músicas à playlist
        await fetchWebApi(`playlists/${playlistId}/tracks`, 'POST', {
            uris: trackURIs
        });

        alert('Playlist criada com sucesso! Confira no seu Spotify.');
    } catch (error) {
        console.error('Erro ao criar playlist:', error);
        alert('Erro ao criar a playlist. Verifique o console para mais detalhes.');
    }
}

// Adiciona o evento de clique ao botão
document.getElementById('generatePlaylistButton').addEventListener('click', createPlaylist);
</script>

</body>
</html>
